{% extends 'base.html' %}
{% load static %}

{% block title %}Relatórios{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="app-container">
    <div class="header-nav" style="justify-content: center;">
        <span class="navbar-brand" style="color: var(--primary);">
            <i class="fas fa-chart-pie"></i> Resumo Financeiro
        </span>
    </div>

    <div style="padding: 20px;">
        <form method="get" style="display: flex; gap: 10px; align-items: flex-end;">
            <div style="flex: 1;">
                {{ form.data_inicio.label_tag }}
                {{ form.data_inicio }}
            </div>
            <div style="flex: 1;">
                {{ form.data_fim.label_tag }}
                {{ form.data_fim }}
            </div>
            <button type="submit" class="btn-primary" style="width: auto; padding: 10px 20px;">
                <i class="fas fa-filter"></i>
            </button>
        </form>
    </div>

    <div class="dashboard-grid">
        <div class="kpi-card">
            <div class="kpi-label">Vendas (Cartão/Pix)</div>
            <div class="kpi-value val-blue">R$ {{ total_cartao|floatformat:2 }}</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">Vendas (Dinheiro)</div>
            <div class="kpi-value val-orange">R$ {{ total_dinheiro|floatformat:2 }}</div>
        </div>
        <div class="kpi-card full-width">
            <div class="kpi-label">Receita Total</div>
            <div class="kpi-value" style="font-size: 1.5rem; color: var(--success);">R$ {{ receita_total|floatformat:2 }}</div>
        </div>
        <div class="kpi-card full-width">
            <div class="kpi-label">Lucro Operacional ( - Saídas)</div>
            <div class="kpi-value" style="font-size: 1.5rem; color: #1f2937;">R$ {{ lucro_operacional|floatformat:2 }}</div>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-title">Top Despesas (Saídas)</div>
        {% for cat in cats_saida %}
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f3f4f6;">
                <span>{{ cat.categoria__nome }}</span>
                <span style="color: var(--danger);">R$ {{ cat.total|floatformat:2 }}</span>
            </div>
        {% empty %}
            <p style="text-align: center; color: #9ca3af;">Nenhuma saída no período.</p>
        {% endfor %}
        
        <div style="margin-top: 10px; text-align: right; font-weight: bold; color: var(--danger);">
            Total: R$ {{ total_saida|floatformat:2 }}
        </div>
    </div>

</div>
{% endblock %}