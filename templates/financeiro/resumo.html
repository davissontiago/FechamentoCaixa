{% extends 'base.html' %}
{% load static %}

{% block title %}Relatório Financeiro{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="app-container">
    
    <div class="resumo-header">
        <form method="get" class="filter-form">
            <div class="form-group">
                {{ form.data_inicio.label_tag }}
                {{ form.data_inicio }}
            </div>
            <div class="form-group">
                {{ form.data_fim.label_tag }}
                {{ form.data_fim }}
            </div>
            <button type="submit" class="btn-filter">
                <i class="fas fa-search"></i>
            </button>
        </form>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card kpi-full">
            <div class="kpi-label">Receita Total (Vendas)</div>
            <div class="kpi-value">R$ {{ receita_total|floatformat:2 }}</div>
        </div>
        
        <div class="kpi-card">
            <div class="kpi-label text-warning"><i class="fas fa-money-bill"></i> Dinheiro</div>
            <div class="kpi-value">R$ {{ total_dinheiro|floatformat:2 }}</div>
        </div>
        
        <div class="kpi-card">
            <div class="kpi-label text-blue"><i class="fas fa-credit-card"></i> Cartão/Pix</div>
            <div class="kpi-value">R$ {{ total_cartao|floatformat:2 }}</div>
        </div>
        
        <div class="kpi-card">
            <div class="kpi-label text-danger"><i class="fas fa-arrow-down"></i> Saídas</div>
            <div class="kpi-value">R$ {{ total_saida|floatformat:2 }}</div>
        </div>
        
        <div class="kpi-card">
            <div class="kpi-label text-success"><i class="fas fa-wallet"></i> Líquido</div>
            <div class="kpi-value">R$ {{ lucro_operacional|floatformat:2 }}</div>
        </div>
    </div>

    <div class="section-title">Detalhamento Cartão/Pix</div>
    {% if cats_cartao %}
        <table class="cat-table">
            {% for item in cats_cartao %}
            <tr>
                <td>
                    {{ item.categoria__nome }}
                    <div class="bar-container">
                        <div class="bar-fill bg-blue" style="width: {% widthratio item.total total_cartao 100 %}%;"></div>
                    </div>
                </td>
                <td class="cat-val">R$ {{ item.total|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <div class="empty-msg">Sem vendas no cartão neste período.</div>
    {% endif %}

    <div class="section-title">Detalhamento Saídas</div>
    {% if cats_saida %}
        <table class="cat-table">
            {% for item in cats_saida %}
            <tr>
                <td>
                    {{ item.categoria__nome }}
                    <div class="bar-container">
                        <div class="bar-fill bg-red" style="width: {% widthratio item.total total_saida 100 %}%;"></div>
                    </div>
                </td>
                <td class="cat-val text-danger">- R$ {{ item.total|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <div class="empty-msg">Sem saídas neste período.</div>
    {% endif %}

    <div class="section-title">Detalhamento Entradas (Suprimentos)</div>
    {% if cats_entrada %}
        <table class="cat-table">
            {% for item in cats_entrada %}
            <tr>
                <td>
                    {{ item.categoria__nome }}
                    <div class="bar-container">
                        <div class="bar-fill bg-purple" style="width: {% widthratio item.total total_entrada 100 %}%;"></div>
                    </div>
                </td>
                <td class="cat-val text-purple">+ R$ {{ item.total|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <div class="empty-msg">Sem entradas extras neste período.</div>
    {% endif %}

    <div style="height: 50px;"></div>
</div>
{% endblock %}